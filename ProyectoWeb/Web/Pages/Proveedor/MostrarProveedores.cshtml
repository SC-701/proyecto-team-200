@page
@model Web.Pages.Proveedor.MostrarProveedoresModel
@{
    }
    <head>

        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

        <link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />

        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
        <style>
            body {
                font-family: 'Inter', sans-serif;
                background-color: #f8f9fa;
                padding: 20px;
            }

            h1.page-title {
                font-weight: 600;
                margin-bottom: 30px;
                color: #212529;
                text-align: center;
            }

            .btn-primary {
                box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
                font-weight: 600;
            }

            table.dataTable thead th {
                background-color: #007bff;
                color: white;
                font-weight: 600;
            }

            table.dataTable tbody tr:hover {
                background-color: #e9f2ff;
            }

            .btn-sm i {
                margin-right: 6px;
            }

            .modal-content {
                border-radius: 12px;
            }

            .modal-header {
                background-color: #0d6efd;
                color: white;
            }

            .modal-body p {
                margin-bottom: 8px;
            }

            .table td,
            .table th {
                vertical-align: middle;
            }

            .rounded-table {
                border-radius: 10px;
                overflow: hidden;
            }

            .btn-rounded {
                border-radius: 20px;
                padding: 6px 12px;
            }

            .dataTables_filter input {
                border-radius: 20px !important;
                border: 1px solid #ccc !important;
                padding: 5px 10px !important;
                margin-bottom: 20px !important;
            }

            .dataTables_length select {
                border-radius: 50px !important;
                padding: 6px !important;
                border: 1px solid #ccc !important;
            }

            .dataTables_paginate a.paginate_button {
                border-radius: 6px !important;
                padding: 5px 10px !important;
                margin-top: 12px !important;
                border: 1px solid #ccc !important;
            }

            .dataTables_wrapper .row:first-child {
                margin-bottom: 20px;
            }

            .dataTables_filter {
                display: flex !important;
                align-items: center !important;
                gap: 10px !important;
            }

            #tablaCategorias tbody tr:hover {
                background-color: #f1f1f1 !important;
                cursor: pointer !important;
            }

            .dataTables_wrapper .row:first-child {
                display: flex;
                justify-content: space-between !important;
                align-items: center !important;
                margin-bottom: 20px !important;
            }
        </style>
    </head>

    <body>
        <h1 class="page-title">Gestión de Proveedores</h1>

        <div class="mb-4 d-flex justify-content-end gap-2">
            <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#agregarProveedorModal">
                <i class="bi bi-plus-lg"></i> Agregar proveedor
            </button>
      
        </button>
        </div>
        <div class="table-responsive">
            <table id="tablaProveedores" class="table table-striped table-bordered rounded-table text-center">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Nombre del proveedor</th>
                        <th>Correo electrónico</th>
                        <th>Tipo</th>
                        <th>Dirección</th>
                        <th>Teléfono</th>
                        <th>Nombre de contacto</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var proveedor in Model.proveedores)
                    {
                                <tr data-id="@proveedor.PROVEEDOR_ID">
                            <td></td>
                            <td>@proveedor.Nombre_PROVEEDOR</td>
                            <td>@proveedor.Correo_ELECTRONICO</td>
                            <td>@proveedor.TIPO</td>
                            <td>@proveedor.Direccion</td>
                            <td>@proveedor.Telefono</td>
                            <td>@proveedor.Nombre_Contacto</td>
                            <td>
                                @if (proveedor.ESTADO_ID == 1)
                                {
                                    <button class="btn btn-success btn-sm toggle-estado btn-rounded" data-id="@proveedor.ESTADO_ID" data-estado="Activo">
                                        Activo
                                    </button>
                                }
                                else
                                {
                                    <button class="btn btn-warning btn-sm toggle-estado btn-rounded" data-id="@proveedor.ESTADO_ID" data-estado="Inactivo">
                                        Inactivo
                                    </button>
                                }
                            </td>
                            
                            <td>
                                <div class="d-flex justify-content-center gap-2">
                                   

                                <a class="btn btn-primary btn-sm btn-rounded"
                                   asp-page="./EditarProveedor"
                                   asp-route-PROVEEDOR_ID="@proveedor.PROVEEDOR_ID">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                    <a class="btn btn-danger btn-sm btn-rounded"
                                       asp-page="./EliminarProveedor"
                                       asp-route-PROVEEDOR_ID="@proveedor.PROVEEDOR_ID">
                                        <i class="bi bi-trash"></i> 
                                    </a>

                                    <a class="btn btn-primary btn-sm btn-rounded"
                                       asp-page="./DetalleProveedor"
                                       asp-route-PROVEEDOR_ID="@proveedor.PROVEEDOR_ID">
                                        <i class="bi bi-eye"></i> 
                                    </a>

                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>







    </body>
    @section Scripts {
        <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

        <script>
            $(document).ready(function () {
                $('#tablaProveedores').DataTable({
                    language: {
                        url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                    },
                    "columnDefs": [
                        {
                            "targets": 0,
                            "data": null,
                            "render": function (data, type, row, meta) {
                                return meta.row + 1;
                            }
                        }
                    ]
                });


            });
        </script>
        <script>
 

  $(document).on('submit', '#formAgregarProveedor', function (e) {
      e.preventDefault();

      var $form = $(this);
      var url = $form.attr('action');
      var formData = new FormData(this);

      $.ajax({
          url: url,
          type: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          headers: { 'RequestVerificationToken': antiForgeryToken },
          success: function (response) {
              if (response && response.success) {
                  $('#agregarProveedorModal').modal('hide');
                  location.reload();
              } else {
                  
                  $('#agregarProveedorModal .modal-content').html(response);
              }
          },
          error: function (xhr) {
              $('#agregarProveedorModal .modal-content').html(xhr.responseText || '<div class="p-3 text-danger">Error al guardar.</div>');
          }
      });
  });
</script>
    }
